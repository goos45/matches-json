<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Player</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial
}
#loading{
  text-align:center;
  padding:20px;
  font-size:18px
}
video, iframe{
  width:100%;
  height:100vh;
  border:none;
  display:none
}
#error{
  color:#ff5555;
  text-align:center;
  padding:20px
}
</style>
</head>

<body>

<div id="loading">جاري التحميل...</div>
<div id="error"></div>

<video id="video" controls autoplay></video>
<iframe id="frame" allowfullscreen allow="autoplay"></iframe>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
// 1️⃣ قراءة البراميترات
const params = new URLSearchParams(window.location.search);
const channel = params.get("channel");
const serv = params.get("serv");

// 2️⃣ عناصر الصفحة
const video = document.getElementById("video");
const frame = document.getElementById("frame");
const loading = document.getElementById("loading");
const errorBox = document.getElementById("error");

if(!channel || !serv){
  showError("رابط غير صالح");
}

// 3️⃣ جلب JSON
fetch("channels.json")
.then(res => res.json())
.then(data => {

  if(!data[channel]){
    showError("القناة غير موجودة");
    return;
  }

  const stream = data[channel].servers[serv];

  if(!stream){
    showError("السيرفر غير متوفر");
    return;
  }

  loading.style.display="none";

  // 4️⃣ تشغيل البث
  if(stream.includes(".m3u8")){
    frame.style.display="none";
    video.style.display="block";

    if(Hls.isSupported()){
      const hls = new Hls();
      hls.loadSource(stream);
      hls.attachMedia(video);
    }else{
      video.src = stream;
    }

  }else{
    video.style.display="none";
    frame.style.display="block";
    frame.src = stream;
  }

})
.catch(()=>{
  showError("فشل تحميل البيانات");
});

function showError(msg){
  loading.style.display="none";
  errorBox.innerText = msg;
}
</script>

</body>
</html>
