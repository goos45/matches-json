<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
const JSON_URL =
"https://raw.githubusercontent.com/goos45/matches-json/main/matches.json";

const params = new URLSearchParams(location.search);
const matchIndex = params.get("match");
const serv = params.get("serv");

if(matchIndex === null || !serv){
  document.body.innerHTML="رابط غير صحيح";
  throw new Error("Missing params");
}

fetch(JSON_URL)
.then(res => res.json())
.then(matches => {

  if(!matches[matchIndex] || !matches[matchIndex].servers[serv]){
    document.body.innerHTML="المباراة أو السيرفر غير موجود";
    return;
  }

  const url = matches[matchIndex].servers[serv];
  play(url);
})
.catch(()=>{
  document.body.innerHTML="فشل تحميل البيانات";
});

let hls;
function play(url){
  const video=document.getElementById("video");
  const iframe=document.getElementById("iframe");

  if(url.includes(".m3u8")){
    iframe.style.display="none";
    video.style.display="block";

    if(Hls.isSupported()){
      hls=new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
    }else{
      video.src=url;
      video.play();
    }
  }else{
    video.style.display="none";
    iframe.style.display="block";
    iframe.src=url;
  }
}
</script>

